<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sleep Tracker - WellNest</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
  <div class="logo-container">
    <img src="images/fitness-logo.svg" alt="WellNest Fitness Logo" />
    <h1>WellNest</h1>
  </div>
  
  <!-- Hamburger Menu Button -->
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>
  
  <ul id="navMenu">
    <li><a href="index.html">Home</a></li>
    <li><a href="body.html">Body</a></li>
    <li><a href="bodyhealth.html">Body Health</a></li>
    <li><a href="mind.html">Mind</a></li>
    <li><a href="sleep.html" class="active">Sleep</a></li>
    <li><a href="diet.html">Diet</a></li>
    <li><a href="workout.html">Workout</a></li>
    <li><a href="care.html">Care</a></li>
    <li><a href="pray.html">Prayer</a></li>
    <li><a href="reminders.html">Reminders</a></li>
    <li><a href="login.html" id="loginLink">Login</a></li>
    <li><a href="signup.html" id="signupLink">Sign Up</a></li>
    <li><a href="#" onclick="logout()" id="logoutLink" style="display:none;">Logout ðŸ‘‹</a></li>
  </ul>
</nav>

<section class="section">
  <h2>Sleep Tracker ðŸŒ™</h2>
  <p>Analyze your sleep patterns and get personalized tips.</p>

  <div class="card-container">
    <div class="card">
      <h3>Hours Slept Today</h3>
      <p id="sleepDisplay">No sleep recorded today</p>
    </div>

    <div class="card">
      <h3>Sleep Quality</h3>
      <p>Good ðŸ˜´</p>
    </div>

    <div class="card">
      <h3>Add Today's Sleep</h3>
      <div class="sleep-input-container">
        <label for="sleepHours">Hours:</label>
        <input type="number" id="sleepHours" min="0" max="24" step="0.5" placeholder="8" class="sleep-input">
        <label for="sleepMinutes">Minutes:</label>
        <input type="number" id="sleepMinutes" min="0" max="59" step="1" placeholder="30" class="sleep-input">
        <button onclick="addSleepHours()" class="sleep-btn">Add Sleep ðŸ’¤</button>
      </div>
    </div>

    <div class="card">
      <h3>Sleep History</h3>
      <div id="sleepHistory">
        <!-- Sleep history will be loaded from localStorage -->
      </div>
    </div>

    <div class="card">
      <h3>Tip of the Night</h3>
      <p>Try to avoid screens 1 hour before bed for better rest.</p>
    </div>
  </div>
</section>

<footer>Â© 2025 WellNest | Designed with ðŸ’š by Tahreem Fatima</footer>

<script>
  // Sleep Tracking Functionality with Persistent Storage
  function addSleepHours() {
    const hours = document.getElementById('sleepHours').value;
    const minutes = document.getElementById('sleepMinutes').value;
    
    if (!hours && !minutes) {
      alert('Please enter sleep hours or minutes! ðŸ˜´');
      return;
    }
    
    const totalHours = parseInt(hours || 0);
    const totalMinutes = parseInt(minutes || 0);
    
    if (totalHours < 0 || totalHours > 24 || totalMinutes < 0 || totalMinutes >= 60) {
      alert('Please enter valid time values! (Hours: 0-24, Minutes: 0-59)');
      return;
    }
    
    // Format sleep display
    let sleepText = '';
    if (totalHours > 0 && totalMinutes > 0) {
      sleepText = `${totalHours} hrs ${totalMinutes} mins`;
    } else if (totalHours > 0) {
      sleepText = `${totalHours} hrs`;
    } else if (totalMinutes > 0) {
      sleepText = `${totalMinutes} mins`;
    }
    
    // Calculate total sleep in minutes for quality assessment
    const totalSleepMinutes = (totalHours * 60) + totalMinutes;
    
    // Save to localStorage with date
    const today = new Date();
    const dateKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    
    const userData = JSON.parse(localStorage.getItem('wellnest_user_data') || '{}');
    
    // Initialize sleep data structure
    if (!userData.sleepHistory) userData.sleepHistory = {};
    if (!userData.calendar) userData.calendar = {};
    
    // Save sleep data
    userData.sleepHistory[dateKey] = {
      hours: totalHours,
      minutes: totalMinutes,
      totalMinutes: totalSleepMinutes,
      sleepText: sleepText,
      quality: getSleepQuality(totalSleepMinutes),
      timestamp: Date.now()
    };
    
    // Update calendar data
    if (!userData.calendar[dateKey]) {
      userData.calendar[dateKey] = {
        activities: {},
        healthMetrics: {},
        score: 0,
        steps: 0
      };
    }
    
    // Mark sleep activity as completed if 7-9 hours
    if (totalSleepMinutes >= 420 && totalSleepMinutes <= 540) { // 7-9 hours
      userData.calendar[dateKey].activities.sleep = true;
    }
    
    // Add sleep as health metric
    userData.calendar[dateKey].healthMetrics.sleep = sleepText;
    
    // Recalculate health score
    userData.calendar[dateKey].score = calculateDayScore(userData.calendar[dateKey]);
    
    // Save to localStorage
    localStorage.setItem('wellnest_user_data', JSON.stringify(userData));
    
    // Update today's sleep display
    document.getElementById('sleepDisplay').textContent = sleepText;
    
    // Refresh sleep history display
    loadSleepHistory();
    
    // Clear input fields
    document.getElementById('sleepHours').value = '';
    document.getElementById('sleepMinutes').value = '';
    
    // Show success message
    alert(`Sleep logged successfully! ðŸŒ™\n${sleepText} added to your tracker.`);
    
    // Provide sleep quality feedback
    const feedback = getSleepQualityFeedback(totalSleepMinutes);
    setTimeout(() => alert(feedback), 1000);
  }

  function getSleepQuality(totalMinutes) {
    if (totalMinutes < 360) return 'Poor'; // Less than 6 hours
    if (totalMinutes >= 420 && totalMinutes <= 540) return 'Excellent'; // 7-9 hours
    if (totalMinutes >= 360 && totalMinutes < 420) return 'Fair'; // 6-7 hours
    if (totalMinutes > 540) return 'Too Much'; // More than 9 hours
    return 'Unknown';
  }

  function getSleepQualityFeedback(totalMinutes) {
    if (totalMinutes < 360) {
      return 'ðŸ˜´ You might need more sleep for optimal health! Aim for 7-9 hours.';
    } else if (totalMinutes >= 420 && totalMinutes <= 540) {
      return 'âœ¨ Excellent! You\'re in the optimal sleep range (7-9 hours).';
    } else if (totalMinutes >= 360 && totalMinutes < 420) {
      return 'ðŸ˜Š Good sleep, but try to get a bit more for optimal recovery.';
    } else {
      return 'ðŸ˜Š That\'s quite a bit of sleep! Make sure it\'s quality rest.';
    }
  }

  function calculateDayScore(dayData) {
    const activities = dayData.activities || {};
    const healthMetrics = dayData.healthMetrics || {};
    
    let score = 0;
    const totalActivities = 6; // Total trackable activities
    const completedActivities = Object.values(activities).filter(Boolean).length;
    
    // Activity score (60% weight)
    score += (completedActivities / totalActivities) * 60;
    
    // Health metrics score (30% weight)
    const healthScore = Object.keys(healthMetrics).length > 0 ? 25 : 0;
    score += healthScore;
    
    // Steps score (10% weight)
    const stepsScore = Math.min((dayData.steps || 0) / 10000, 1) * 15;
    score += stepsScore;
    
    return Math.round(score);
  }

  function loadSleepHistory() {
    const userData = JSON.parse(localStorage.getItem('wellnest_user_data') || '{}');
    const sleepHistory = userData.sleepHistory || {};
    const historyContainer = document.getElementById('sleepHistory');
    
    // Clear existing history
    historyContainer.innerHTML = '';
    
    if (Object.keys(sleepHistory).length === 0) {
      historyContainer.innerHTML = '<p style="color: #666; font-style: italic;">No sleep history yet. Start tracking your sleep!</p>';
      return;
    }
    
    // Sort dates in descending order (most recent first)
    const sortedDates = Object.keys(sleepHistory).sort((a, b) => new Date(b) - new Date(a));
    
    sortedDates.slice(0, 10).forEach(dateKey => { // Show last 10 entries
      const sleepData = sleepHistory[dateKey];
      const date = new Date(dateKey);
      const dateStr = date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
      });
      
      const entry = document.createElement('p');
      entry.innerHTML = `ðŸ“… ${dateStr}: ${sleepData.sleepText} <span style="color: ${getQualityColor(sleepData.quality)};">(${sleepData.quality})</span>`;
      entry.style.color = '#2C6E63';
      entry.style.fontWeight = '500';
      entry.style.padding = '8px';
      entry.style.borderLeft = `3px solid ${getQualityColor(sleepData.quality)}`;
      entry.style.marginBottom = '5px';
      entry.style.borderRadius = '5px';
      entry.style.background = '#f8f9fa';
      
      historyContainer.appendChild(entry);
    });
  }

  function getQualityColor(quality) {
    switch(quality) {
      case 'Excellent': return '#4CAF50';
      case 'Good': return '#8BC34A';
      case 'Fair': return '#FF9800';
      case 'Poor': return '#F44336';
      case 'Too Much': return '#9C27B0';
      default: return '#666';
    }
  }

  function loadTodaysSleep() {
    const today = new Date();
    const dateKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    
    const userData = JSON.parse(localStorage.getItem('wellnest_user_data') || '{}');
    const sleepHistory = userData.sleepHistory || {};
    
    if (sleepHistory[dateKey]) {
      document.getElementById('sleepDisplay').textContent = sleepHistory[dateKey].sleepText;
    } else {
      document.getElementById('sleepDisplay').textContent = 'No sleep recorded today';
    }
  }

  // Check authentication
  function checkAuthentication() {
    const isLoggedIn = localStorage.getItem('wellnest_user');
    if (!isLoggedIn || isLoggedIn !== 'true') {
      alert('ðŸ”’ Please login to access your sleep tracker! ðŸŒ¿');
      window.location.href = 'login.html';
      return false;
    }
    return true;
  }

  // Initialize page data
  document.addEventListener('DOMContentLoaded', function() {
    if (checkAuthentication()) {
      loadTodaysSleep();
      loadSleepHistory();
    }
  });

  // Hamburger Menu Functionality
  const hamburger = document.getElementById('hamburger');
  const navMenu = document.getElementById('navMenu');

  hamburger.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    navMenu.classList.toggle('active');
  });

  // Close menu when clicking on a link
  document.querySelectorAll('#navMenu a').forEach(link => {
    link.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navMenu.classList.remove('active');
    });
  });
</script>
</body>
</html>
